# 小鹅通 API 认证与返回码说明

## Access Token

`access_token` 是小鹅通开放 API 的全局唯一接口调用凭据，店铺调用各接口时都需使用 `access_token`，开发者需要进行妥善保管。

### 建议策略

*   建议店铺开发者使用**中控服务器**统一获取和刷新 `access_token`，其他业务逻辑服务器所使用的 `access_token` 均来自于该中控服务器，不应该各自去刷新，否则容易造成冲突，导致 `access_token` 覆盖而影响业务。

### 有效期与刷新

*   `access_token` 的有效期目前为 **2 小时 (7200 秒)**，需定时刷新。
*   重复获取将导致上次获取的 `access_token` 在 **5 分钟之后**失效。
*   在刷新过程中，中控服务器可对外继续输出老的 `access_token`，在 5 分钟内，新老 `access_token` 都可用，确保第三方业务能够平滑过渡。

### 频率限制

*   获取 `access_token` 的接口调用频率限制为 **10 分钟 100 次**。超出请求次数该接口须等下个 10 分钟才可以恢复调用。

### IP 白名单

*   为了提高 API 接口的安全性，只有在 **IP 白名单** 里面的 IP，才能成功获取到 `access_token`，否则拒绝访问。
*   调用接口前，请在云服务控制台中提前将服务器的 IP 添加到白名单中。

### 获取 Access Token 接口

*   **请求方式:** `GET`
*   **接口地址:** `https://api.xiaoe-tech.com/token`
*   **请求头:** `Content-Type: application/json` (注意：虽然是 GET 请求，但文档示例如此指定)
*   **必需参数 (通常作为 URL Query Params):**
    *   `app_id`
    *   `client_id`
    *   `secret_key`
    *   `grant_type` (固定值为 `client_credential`)

## API 调用方式

*   调用具体业务接口时，将获取到的 `access_token` 作为**请求体 JSON 数据**的一部分（通常是顶级字段 `access_token`）传递，而不是放在 HTTP Header 中。

## 返回码详细说明

| 返回码 | 说明                                                                                |
| ------ | ----------------------------------------------------------------------------------- |
| 1001   | 系统繁忙                                                                            |
| 1002   | 业务接口返回值格式错误                                                              |
| 2001   | 缺失 `app_id` 参数                                                                  |
| 2002   | 错误 `app_id` 参数                                                                  |
| 2003   | 缺失 `secret_key` 参数                                                              |
| 2004   | `secret_key` 错误，或者 `app_id` 无效。请开发者认真比对 `app_id`, `secret_key` 的正确性 |
| 2005   | 缺失 `grant_type` 参数                                                              |
| 2006   | 错误 `grant_type` 参数 (文档原文与 2005 重复，推测此处应为 "错误 grant_type")        |
| 2007   | 缺失凭证 `access_token` (业务接口调用时)                                             |
| 2008   | `access_token` 过期或者不存在                                                       |
| 2009   | 缺失 `userid` 参数 (特定接口需要时)                                                  |
| 2010   | `user_id` 无效 (特定接口需要时)                                                    |
| 2017   | 没有请求本接口的权限，请申请对应接口权限集                                          |
| 2020   | 无效的 `client_id`                                                                  |
| 2051   | IP 没有添加白名单，需用户配置服务器白名单 IP                                          |
| 2052   | 没有提供该 API，用户请求的 URL 错误，或者该 URL 没有在系统中注册                      |
| 2053   | API 的调用次数达到上限                                                              |
| 2054   | API 的请求短时间突增                                                                |
| 2055   | API 请求方式错误 (例如，应为 POST 但使用了 GET)                                     |

</rewritten_file> 